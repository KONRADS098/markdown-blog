{{ if .Params.series }} {{ $currentPage := . }} {{ $seriesName := .Params.series
}} {{ $currentOrder := .Params.series_order }} {{ $seriesColor :=
.Params.series_color | default "#0984e3" }} {{ $totalParts :=
.Params.series_total_parts | default 0 }}

<!-- Get all published pages in this series -->
{{ $publishedPages := slice }} {{ range where .Site.RegularPages "Params.series"
$seriesName }} {{ if .Params.series_order }} {{ $publishedPages =
$publishedPages | append . }} {{ end }} {{ end }} {{ $publishedPages = sort
$publishedPages "Params.series_order" }} {{ $publishedParts := len
$publishedPages }}

<!-- Determine if there are upcoming parts -->
{{ $hasUpcoming := false }} {{ if gt $totalParts 0 }} {{ $hasUpcoming = gt
$totalParts $publishedParts }} {{ end }}

<!-- Show series navigation if there's more than one part OR if there are upcoming parts -->
{{ if or (gt $publishedParts 1) $hasUpcoming }}
<nav
  class="series-nav"
  aria-label="Series navigation"
  style="border-left-color: {{ $seriesColor }};"
>
  <div class="series-header">
    <span class="series-label" style="color: {{ $seriesColor }};"
      >Part {{ $currentOrder }}{{ if gt $totalParts 0 }} of {{ $totalParts }}{{
      end }}</span
    >
    <span class="series-name">{{ $seriesName }} Series</span>
  </div>

  <ol class="series-list">
    {{ range $publishedPages }}
    <li
      class="series-item{{ if eq .RelPermalink $currentPage.RelPermalink }} current{{ end }}"
    >
      {{ if eq .RelPermalink $currentPage.RelPermalink }}
      <span class="series-current"
        >{{ .Params.series_order }}. {{ .Title }}
        <span class="you-are-here">(You are here)</span></span
      >
      {{ else }}
      <a href="{{ .RelPermalink }}">{{ .Params.series_order }}. {{ .Title }}</a>
      {{ end }}
    </li>
    {{ end }} {{ if $hasUpcoming }}
    <li class="series-item upcoming">
      <span class="series-upcoming">More parts coming soon...</span>
    </li>
    {{ end }}
  </ol>
</nav>
{{ end }} {{ end }}
